
### ğŸ” ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ  

![2021-07-18 23 34 52](https://user-images.githubusercontent.com/80666066/126178511-07977800-bcbd-4073-8f21-a8d54c7e10a7.gif)

ë¨¼ì € í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  axiosë¡œ ì œì¶œí•˜ë©´,  
ì„œë²„ì—ì„œ ë°˜í™˜ë°›ì€ ê²°ê³¼ê°€ ì„±ê³µì´ë©´ ë©”ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œí‚¤ê³ ,  
ì‹¤íŒ¨ë©´ ì•ŒëŒìœ¼ë¡œ 'Error'ë¼ëŠ” ë©”ì„¸ì§€ë¥¼ ë„ì›Œì¤€ë‹¤  

<br/>

```javascript
const onSubmitHandler = (event) => {
  event.preventDefault();
  
  let body = {
    email: Email,
    password: Password
  }
  
  dispatch(loginUser(body))
    .then(response => {
      if(response.payload.loginSuccess) {
        props.history.push('/')
      } else {
        alert('Error')
      }
    })
}
```

<br/>

user ìŠ¤í‚¤ë§ˆì™€ ê´€ë ¨ëœ ë©”ì„œë“œë“¤ì€ ë”°ë¡œ user_action.js íŒŒì¼ì— ì‘ì„±í–ˆë‹¤  

<br/>

```javascript
export function loginUser(dataTosubmit) {
  const request = axios.post('/api/users/login', dataTosubmit)
    .then(response => response.data )
  
  return {
    type: LOGIN_USER,
    payload: request
  }
}
```

<br/>

ìœ„ api ì£¼ì†Œì— ì‘ë‹µí•˜ëŠ” ì„œë²„ë‹¨ì˜ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤ 

<br/>

```javascript
app.post('/api/users/login', (req, res) => {
    //ìš”ì²­ëœ ì´ë©”ì¼ì„ DBì—ì„œ ìˆëŠ”ì§€ ì°¾ëŠ”ë‹¤
    User.findOne({ email: req.body.email }, (err, user) => {
        if(!user){
            return res.json({
                loginSuccess: false,
                message: "ì œê³µëœ ì´ë©”ì¼ì— í•´ë‹¹í•˜ëŠ” ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤."
            })
        }
        //ìš”ì²­ëœ ì´ë©”ì¼ì´ DBì— ìˆë‹¤ë©´, ë¹„ë°€ë²ˆí˜¸ê°€ ë§ëŠ”ì§€ í™•ì¸  
        user.comparePassword(req.body.password, (err, isMatch) => {
            if(!isMatch)
                return res.json({loginSuccess: false, message: "ë¹„ë°€ë¨¼í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."})

            //ë¹„ë°€ë²ˆí˜¸ê¹Œì§€ ì¼ì¹˜í•œë‹¤ë©´ í† í°ì„ ìƒì„±
            user.generateToken((err, user) => {
                if(err) return res.status(400).send(err);

                //í† í°ì„ ì¿ í‚¤ì— ì €ì¥ 
                res.cookie("x_auth", user.token)
                .status(200)
                .json({loginSuccess: true, userId: user._id})
            })
        })
    })
})
```

<br/>

ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¹„êµí•˜ëŠ” ë©”ì„œë“œë„ user ìŠ¤í‚¤ë§ˆì— ì‘ì„±í–ˆë‹¤  
ë¹„ë°€ë²ˆí˜¸ëŠ” bcrypt ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì•”í˜¸í™” í•´ì¤¬ê¸°ì—, ì—­ì‹œë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë¹„êµí•´ì¤€ë‹¤  

<br/>

```javascript
userSchema.methods.comparePassword = function(plainPassword, cb) {
    bcrypt.compare(plainPassword, this.password, function(err, isMatch) {
        if(err) return cb(err)
            cb(null, isMatch)
    })
}
```

<br/>

![2021-07-22 21 28 14](https://user-images.githubusercontent.com/80666066/126644797-f7efdc0b-8030-4318-96ce-6cf2d75ac9cc.gif)

ë¡œê·¸ì•„ì›ƒì€ í˜„ì¬ ë¡œê·¸ì¸ ì¤‘ì´ë¼ë©´ í† í°ì„ ì‚­ì œí•˜ê³  ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œì¼œì£¼ë©°,  
ë¡œê·¸ì¸ ì¤‘ì´ ì•„ë‹ ì‹œì—ëŠ” ë¡œê·¸ì•„ì›ƒì— ì‹¤íŒ¨í–ˆë‹¤ëŠ” ì•Œë¦¼ì„ ë„ì›Œì¤€ë‹¤  

<br/>

```javascript
const logoutHandler = () => {
    axios.get('/api/users/logout')
      .then(response => {
          if(response.data.success) {
              props.history.push("/login")
          } else {
              alert('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨')
          }
      })
}
```

<br/>

í† í°ì€ ë¡œê·¸ì¸ í•  ë•Œ ìƒì„±ë˜ì–´ DBì— ì €ì¥ë˜ê³ ,  
ì´ í† í°ì˜ ì—¬ë¶€ì— ë”°ë¼ì„œ authë¥¼ í†µí•´ í˜ì´ì§€ë§ˆë‹¤ ê²€ì¦ì´ ì´ë¤„ì§„ë‹¤  
ê·¸ë˜ì„œ ë¡œê·¸ì•„ì›ƒ ì‹œ í† í°ì„ ê³µë°± ë¬¸ìë¡œ ë³€ê²½í•´ì¤€ë‹¤  

<br/>

```javascript
app.get('/api/users/logout', auth, (req, res) => {
    User.findOneAndUpdate({ _id: req.user._id}, 
        { token: "" }
        , (err, user) => {
            if(err) return res.json({ success: false, err});
            return res.status(200).send({
                success: true
            })
        })
})
```

<br/>



